{"ts":1368022198768,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var api = api || {};\r\napi = {\r\n\tconfig: {\r\n\t\tulrs311: {\r\n\t\t\tbase: \"http://services.phila.gov/ULRS311/Data/\" // Ideally this should allow jsonp. ETA 2012-11-11\r\n\t\t\t,location: \"Location/\"\r\n\t\t\t,timeout: 20000\r\n\t\t\t,minConfidence: 75\r\n\t\t}\r\n\t\t,gisServer: {\r\n\t\t\tbase: \"http://gis.phila.gov/ArcGIS/rest/services/\"\r\n\t\t\t,pollingPlaces: \"PhilaGov/PollingPlaces/MapServer/1/\"\r\n\t\t\t,defaultParams: \"query?geometryType=esriGeometryPoint&inSR=4326&spatialRel=esriSpatialRelWithin&returnCountOnly=false&returnIdsOnly=false&returnGeometry=false&outFields=WARD_1%2CDIVISION_1%2CPOLLING_PL%2CADDRESS&f=pjson&geometry=\"\r\n\t\t\t,timeout: 20000\r\n\t\t}\r\n\t\t,gmaps: {\r\n\t\t\tquery: \"http://maps.google.com/maps?q=\"\r\n\t\t\t,staticmap: \"http://maps.googleapis.com/maps/api/staticmap?zoom=17&size={width}x{height}&sensor=false&center={address}&markers={address}&key=\"\r\n\t\t\t,apiKey: \"AIzaSyCmJ45zmFdmbe_j7QtgAXLUTNl1gRFzJl4\"\r\n\t\t\t,width: 260\r\n\t\t\t,height: 200\r\n\t\t}\r\n\t\t,civicinfo: {\r\n\t\t\tbase: \"https://www.googleapis.com/civicinfo/us_v1/\"\r\n\t\t\t,voterinfo: \"voterinfo/4000/lookup?fields=contests%2CnormalizedInput%2Cstatus&key=\"\r\n\t\t\t,apiKey: \"AIzaSyCmJ45zmFdmbe_j7QtgAXLUTNl1gRFzJl4\"\r\n\t\t}\r\n\t}\r\n\t\r\n\t,geocode: function(input, successCallback, errorCallback) {\r\n\t\tvar url = api.config.ulrs311.base + api.config.ulrs311.location + encodeURIComponent(input);\r\n\t\t$.ajax({\r\n\t\t\turl: url\r\n\t\t\t,timeout: api.config.ulrs311.timeout\r\n\t\t\t,cache: true\r\n\t\t\t,error: errorCallback\r\n\t\t\t,success: function(data) {\r\n\t\t\t\tvar location = null;\r\n\t\t\t\tif(data.Locations !== undefined && data.Locations.length) {\r\n\t\t\t\t\tfor(i in data.Locations) {\r\n\t\t\t\t\t\tif(data.Locations[i].Address.Similarity >= api.config.ulrs311.minConfidence) {\r\n\t\t\t\t\t\t\tlocation = data.Locations[i];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tsuccessCallback(location);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\t,getPollingPlace: function(x, y, successCallback, errorCallback) {\r\n\t\tvar geometry = \"{\\\"x\\\":\" + x + \",\\\"y\\\":\" + y + \"}\";\r\n\t\tvar url = api.config.gisServer.base + api.config.gisServer.pollingPlaces + api.config.gisServer.defaultParams + encodeURIComponent(geometry);\r\n\t\t$.ajax({\r\n\t\t\turl: url\r\n\t\t\t,dataType: \"jsonp\"\r\n\t\t\t,timeout: api.config.gisServer.timeout\r\n\t\t\t,cache: true\r\n\t\t\t,error: errorCallback\r\n\t\t\t,success: function(data) {\r\n\t\t\t\tvar location = null;\r\n\t\t\t\tif(data.features !== undefined && data.features.length) {\r\n\t\t\t\t\tlocation = data.features[0].attributes;\r\n\t\t\t\t}\r\n\t\t\t\tsuccessCallback(location);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\t,getCandidates: function(input, successCallback, errorCallback) {\r\n\t\tvar url = api.config.civicinfo.base + api.config.civicinfo.voterinfo + api.config.civicinfo.apiKey;\r\n\t\tvar body = {address: input};\r\n\t\t$.ajax({\r\n\t\t\turl: url\r\n\t\t\t,data: JSON.stringify(body)\r\n\t\t\t,type: \"POST\"\r\n\t\t\t,contentType: \"application/json\"\r\n\t\t\t,cache: true\r\n\t\t\t,error: errorCallback\r\n\t\t\t,success: successCallback\r\n\t\t});\r\n\t}\r\n\t\r\n\t,getMapUrl: function(address, width, height) {\r\n\t\treturn api.config.gmaps.query + encodeURIComponent(address);\r\n\t}\r\n\t\r\n\t,getStaticMap: function(address) {\r\n\t\treturn api.config.gmaps.staticmap.replace(/{address}/g, encodeURIComponent(address)).replace(\"{width}\", api.config.gmaps.width).replace(\"{height}\", api.config.gmaps.height) + api.config.gmaps.apiKey;\r\n\t}\r\n}"]],"start1":0,"start2":0,"length1":0,"length2":3180}]],"length":3180}
{"contributors":[],"silentsave":false,"ts":1368022031520,"patch":[[{"diffs":[[0,"pi = {\r\n"],[-1,"\t"],[1,"    "],[0,"config: "]],"start1":23,"start2":23,"length1":17,"length2":20},{"diffs":[[0,"fig: {\r\n"],[-1,"\t\t"],[1,"        "],[0,"ulrs311:"]],"start1":38,"start2":38,"length1":18,"length2":24},{"diffs":[[0,"\"http://"],[1,"staging-"],[0,"gis.phil"]],"start1":270,"start2":270,"length1":16,"length2":24},{"diffs":[[0,"/Polling"],[1,"_"],[0,"Places"],[1,"_May13"],[0,"/MapServ"]],"start1":352,"start2":352,"length1":22,"length2":29},{"diffs":[[0,"WARD"],[-1,"_1"],[0,"%2CDIV"],[-1,"ISION_1%2CPOLLING_PL"],[1,"%2CPLACE"],[0,"%2CA"]],"start1":561,"start2":561,"length1":36,"length2":22},{"diffs":[[0,"\"\r\n\t\t}\r\n"],[1,"\t\t,gdocs: {\r\n\t\t\tkey: \"0AlMaW-4cviLodFdMZGMwWnFUaUoxZjhOMHNQeVE5ckE\"\r\n\t\t}\r\n"],[0,"\t}\r\n\t\r\n\t"]],"start1":1145,"start2":1145,"length1":16,"length2":90},{"diffs":[[0,"e: \"json"],[-1,"p"],[0,"\"\r\n\t\t\t,t"]],"start1":2175,"start2":2175,"length1":17,"length2":16},{"diffs":[[0,"address) {\r\n"],[-1,""],[0,"\t\treturn api"]],"start1":3043,"start2":3043,"length1":24,"length2":24},{"diffs":[[0,"y;\r\n\t}\r\n"],[1,"\t\r\n\t// This doesn't really need to be in api.js, but just for consistency's sake...\r\n\t,getGoogleDoc: function(callback) {\r\n\t\tTabletop.init({\r\n\t\t\tkey: api.config.gdocs.key\r\n\t\t\t,callback: callback\r\n\t\t});\r\n\t}\r\n"],[0,"}"]],"start1":3254,"start2":3254,"length1":9,"length2":216}]],"length":3470,"saved":false}
